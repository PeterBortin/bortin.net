<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>How EASY to FIND YOU</title>
  <style>
    body {
      margin: 0;
      font-family: "Courier New", monospace;
      background: black;
      color: #33ff33;
      text-shadow: 0 0 5px #00ff00;
    }
    h2, h3 {
      margin: 0;
      padding: 0.5em;
      border-bottom: 1px solid #0f0;
      font-weight: normal;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    #self, #users {
      margin: 1em;
      padding: 1em;
      border: 1px solid #0f0;
      background: rgba(0, 20, 0, 0.8);
    }
    .field {
      display: flex;
      margin: 8px 0;
    }
    .field span {
      flex: 0 0 140px;
      font-weight: bold;
    }
    .field div {
      flex: 1;
    }
    .user {
      cursor: pointer;
      padding: 6px;
      margin: 4px 0;
      border-bottom: 1px dashed #0f0;
    }
    .user:hover {
      background: rgba(0,255,0,0.1);
    }
    #userList {
      margin-top: 0.5em;
    }
    .cursor {
      display: inline-block;
      width: 10px;
      background: #33ff33;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 50% { background: transparent; }
      51%, 100% { background: #33ff33; }
    }
  </style>
</head>
<body>
  <h2>HOW EASY TO FIND YOU</h2>

  <div id="self">
    <h3 id="infoTitle">LOCAL USER DATA</h3>
    <div id="selfData"></div>
  </div>

  <div id="users">
    <h3>ACTIVE USERS</h3>
    <div id="userList"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // === ВСТАВЬТЕ СВОИ Firebase-конфиги ===
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myId = null;

    async function getIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        const ip = data.ip;
        const lastDigits = ip.split(".").slice(-2).join(".");
        myId = "user_" + lastDigits;
        return ip;
      } catch (e) {
        myId = "user_xxx.xxx";
        return "N/A";
      }
    }

    function getNetworkType() {
      if (navigator.connection && navigator.connection.effectiveType) {
        return navigator.connection.effectiveType.toUpperCase();
      }
      return "UNKNOWN";
    }

    async function collectInfo() {
      const ip = await getIP();
      return {
        id: myId,
        ip: ip,
        network: getNetworkType(),
        userAgent: navigator.userAgent,
        lang: navigator.language,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        screen: screen.width + "x" + screen.height,
        time: new Date().toLocaleTimeString()
      };
    }

    function renderInfo(info) {
      const out = [];
      for (const [k, v] of Object.entries(info)) {
        out.push(`<div class="field"><span>${k.toUpperCase()}:</span><div>${v}</div></div>`);
      }
      return out.join("") + '<div class="cursor"></div>';
    }

    const selfDataDiv = document.getElementById("selfData");
    const title = document.getElementById("infoTitle");
    const userListDiv = document.getElementById("userList");

    let myInfo = null;
    let ref = null;

    (async () => {
      myInfo = await collectInfo();
      selfDataDiv.innerHTML = renderInfo(myInfo);

      // Записываем себя в Firebase
      ref = db.ref("presence/" + myId);
      ref.set(myInfo);
      ref.onDisconnect().remove();

      // Слушаем список онлайн
      db.ref("presence").on("value", snap => {
        const data = snap.val() || {};
        userListDiv.innerHTML = "";
        Object.values(data).forEach(user => {
          const div = document.createElement("div");
          div.className = "user";
          div.textContent = user.id + (user.ip ? " (" + user.ip + ")" : "");
          div.onclick = () => {
            selfDataDiv.innerHTML = renderInfo(user);
            title.textContent = "REMOTE USER DATA";
          };
          userListDiv.appendChild(div);
        });
      });
    })();

    // Обновление времени каждую секунду
    setInterval(() => {
      if (myInfo && ref) {
        myInfo.time = new Date().toLocaleTimeString();
        selfDataDiv.innerHTML = renderInfo(myInfo);
        ref.update({ time: myInfo.time });
      }
    }, 1000);
  </script>
</body>
</html>